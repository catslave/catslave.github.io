
---
layout: post
title: 云仓平台
category: 架构
description: 云仓平台，解决仓储物流供应链一站式服务，包括订单、仓储、物流等服务。
---

A订单业务线：
入库-订单导入、提交、审核、---仓库内的操作---PDA确认数量入库、生成入库报表。
出库-订单导入、提交、审核、---仓库内的操作---PDA确认数量出库、生成出库报表。

订单层面

方案一：
1.新增一种A订单类型业务服务，客户平台要新增导入A订单接口，oms mapper抽象出A订单Mapper。将A订单数据新增到oms数据库。
2.A订单新增成功后，点击提交，发布A订单类型的订单导入消息到订单消息队列。
3.订单平台新增接收A订单类型的订阅服务，新增A订单操作页面、A订单的获取接口（这些都可以跟前面的抽取到一个服务里面）

基于订单层面的新增订单类型，只要新增订单导入、订单查询、订阅订单类型即可。后面是仓库的操作所以可以屏蔽。但是每新增一个订单类型就要改代码，不是很好的设计。所以可以把订单作为可配置。

方案二（用demo实现下）：
订单配置，在已有的订单类型里面选择一个订单类型，然后勾选需要的字段、勾选必填的字段、需要扫描的字段、校验失败的提示信息，点击保存提交。
订单导入，根据客户和订单类型到订单配置表里面查询需要校验的字段，校验不通过抛出定义好的提示信息，校验通过后新增数据库。
订单查询，根据客户和订单类型到订单配置表里面查询需要显示的字段，动态拼接订单查询sql，查询数据。
订阅订单类型，不需要修改，新的订单是在已有的订单类型下的。

以上通过订单配置的设计就可以满足不同客户对同一业务类型的不同需求设计。但是如果是从平台角度新增业务，那就要走方案一。

仓库层面

不需要PDA

XXX订单平台新增确认入库按钮，更新订单状态，将订单数据直接同步到库存表。XXX，不能这样设计，从流程角度上来说，还是要遵守但是可以从客户端层面屏蔽这些不同。
所以即可不需要PDA，订单平台审核后还是按现有流程，发布订单审核通知，任务平台收到通知后，新建入库任务。再提供确认入库接口，可以由任务平台或订单平台来操作。

那新增A订单对现有操作流程有影响吗？比如生成入库任务需要的信息？对于仓库只需要知道是什么商品，多少数量即可。所以流程不用变。

需要PDA，也需要扫描

释放任务、扫描条形码（这里会根据订单类型分为几种扫描方式）、输入数量，确认收货。  ---- 需要知道进度、状态、结果的才会使用消息队列，另外一些场景就可以直接同步数据。

确认收货，数据就会同步到库存平台，客户平台的库存管理就可以查询到库存数据。

报价/计费系统

包含了客户、合同、费用。订阅任务结果消息，任务执行完后，出账单表。财务人员核对账单，确认账单。

报表平台

库存报表不变，直接从库存平台获取数据。入仓报表，就要从任务平台获取（这个在新增A订单会需要修改吗？把仓库的报表定制好就可以，唯一就是需要显示客户订单配置里面的额外字段）。

需要考虑的问题，
1、几个数据库，几个数据中心、几个消息队列、几个缓存、认证中心、配置中心
2、抽取几个基础服务层模块
3、几个业务层模块
4、几个界面层、客户端。

Redis的应用
单点登录、物流信息缓存（考虑下）

RocketMQ的应用
订单消息、任务消息、

Motan
每个业务平台

库的拆分设计（不应这么细）
1个库：仓库  -- 2015/4 6个月
2个库：仓库、权限 2015/10 3个月
3个库：仓库、权限、计费 2016/2 3个月
4个库：订单、仓库、权限、计费 2016/5 10
5个库：订单、库存、任务、权限、计费 2017/3 6
7个库：订单、库存、任务、权限、计费、基础、历史 2017/9

系统架构发展历程
仓库系统 2015/4 6
订单系统+云仓系统 2016/2
客户平台+订单平台+云仓平台 2017/3
客户平台+订单平台+云仓平台+展示平台 2018/2
